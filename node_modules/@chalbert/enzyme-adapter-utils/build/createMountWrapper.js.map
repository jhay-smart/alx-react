{"version":3,"file":"createMountWrapper.js","names":["stringOrFunction","PropTypes","oneOfType","func","string","makeValidElementType","adapter","validElementTypeRequired","props","propName","isValidElementType","args","isRequired","propValue","TypeError","validElementType","createMountWrapper","node","options","WrappingComponent","wrappingComponent","WrapperComponent","wrappingComponentProps","context","state","mount","newProps","newContext","callback","undefined","oldProps","oldContext","setState","Component","refProp","component","React","propTypes","object","shape","current","any","defaultProps","type","contextTypes","childContextTypes","prototype","getChildContext"],"sources":["../src/createMountWrapper.jsx"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport RootFinder from './RootFinder';\n\nconst stringOrFunction = PropTypes.oneOfType([PropTypes.func, PropTypes.string]);\nconst makeValidElementType = (adapter) => {\n  if (!adapter) {\n    return stringOrFunction;\n  }\n\n  function validElementTypeRequired(props, propName, ...args) {\n    if (!adapter.isValidElementType) {\n      return stringOrFunction.isRequired(props, propName, ...args);\n    }\n    const propValue = props[propName];\n    if (adapter.isValidElementType(propValue)) {\n      return null;\n    }\n    return new TypeError(`${propName} must be a valid element type!`);\n  }\n\n  function validElementType(props, propName, ...args) {\n    const propValue = props[propName];\n    if (propValue == null) {\n      return null;\n    }\n    return validElementTypeRequired(props, propName, ...args);\n  }\n  validElementType.isRequired = validElementTypeRequired;\n\n  return validElementType;\n};\n\n/**\n * This is a utility component to wrap around the nodes we are\n * passing in to `mount()`. Theoretically, you could do everything\n * we are doing without this, but this makes it easier since\n * `renderIntoDocument()` doesn't really pass back a reference to\n * the DOM node it rendered to, so we can't really \"re-render\" to\n * pass new props in.\n */\nexport default function createMountWrapper(node, options = {}) {\n  const { adapter, wrappingComponent: WrappingComponent } = options;\n\n  class WrapperComponent extends React.Component {\n    constructor(...args) {\n      super(...args);\n      const { props, wrappingComponentProps, context } = this.props;\n      this.state = {\n        mount: true,\n        props,\n        wrappingComponentProps,\n        context,\n      };\n    }\n\n    setChildProps(newProps, newContext, callback = undefined) {\n      const { props: oldProps, context: oldContext } = this.state;\n      const props = { ...oldProps, ...newProps };\n      const context = { ...oldContext, ...newContext };\n      this.setState({ props, context }, callback);\n    }\n\n    setWrappingComponentProps(props, callback = undefined) {\n      this.setState({ wrappingComponentProps: props }, callback);\n    }\n\n    render() {\n      const { Component, refProp } = this.props;\n      const { mount, props, wrappingComponentProps } = this.state;\n      if (!mount) return null;\n      const component = <Component ref={refProp} {...props} />;\n      if (WrappingComponent) {\n        return (\n          <WrappingComponent {...wrappingComponentProps}>\n            <RootFinder>{component}</RootFinder>\n          </WrappingComponent>\n        );\n      }\n      return component;\n    }\n  }\n  WrapperComponent.propTypes = {\n    Component: makeValidElementType(adapter).isRequired,\n    context: PropTypes.object,\n    props: PropTypes.object.isRequired,\n    refProp: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.func,\n      PropTypes.shape({\n        current: PropTypes.any,\n      }),\n    ]),\n    wrappingComponentProps: PropTypes.object,\n  };\n  WrapperComponent.defaultProps = {\n    refProp: null,\n    context: null,\n    wrappingComponentProps: null,\n  };\n\n  if (options.context && (node.type.contextTypes || options.childContextTypes)) {\n    // For full rendering, we are using this wrapper component to provide context if it is\n    // specified in both the options AND the child component defines `contextTypes` statically\n    // OR the merged context types for all children (the node component or deeper children) are\n    // specified in options parameter under childContextTypes.\n    // In that case, we define both a `getChildContext()` function and a `childContextTypes` prop.\n    const childContextTypes = {\n      ...node.type.contextTypes,\n      ...options.childContextTypes,\n    };\n\n    WrapperComponent.prototype.getChildContext = function getChildContext() {\n      return this.state.context;\n    };\n    WrapperComponent.childContextTypes = childContextTypes;\n  }\n  return WrapperComponent;\n}\n"],"mappings":"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"}